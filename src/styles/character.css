/* Walking Character */
.walking-character {
  --character-img1: url('../assets/miku1.png');
  --character-img2: url('../assets/miku2.png');
  position: fixed;
  bottom: 10%; /* Position on the street level */
  left: 15%; /* Keep character in one place on screen */
  width: 250px;
  height: 390px;
  background-image: var(--character-img1);

  background-size: contain;
  background-repeat: no-repeat;
  background-position: bottom center;
  z-index: 5;
  animation: walkingFrames 1.026s steps(1) infinite,
    bounce 0.513s ease-in-out infinite;
  will-change: transform, background-image;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Ending Characters - Completely independent from walking character */
.ending-character {
  /* CSS Custom Properties */
  --character-img1: url('../assets/miku1.png');
  --character-img2: url('../assets/miku2.png');
  --end-position: 15%;
  --animation-delay: 0ms;

  /* Positioning and Layout */
  position: fixed;
  bottom: 10%;
  right: var(--end-position);
  width: 250px;
  height: 390px;
  z-index: 4;

  /* Background/Image Properties */
  background-image: var(--character-img1);
  background-size: contain;
  background-repeat: no-repeat;
  background-position: bottom center;

  /* Initial State - invisible at final position */
  opacity: 0;
  transform: translateZ(0) scaleX(-1);

  /* Initial animation - just walking frames */
  animation: endingWalkingFrames 1.026s steps(1) infinite;

  /* Performance Optimizations */
  will-change: transform, background-image, opacity;
  backface-visibility: hidden;
}

/* Fade-in state for ending characters - simple fade with walking */
.ending-character.fade-in {
  animation: endingFadeIn 2s ease-out var(--animation-delay) forwards,
    endingWalkingFrames 1.026s steps(1) infinite,
    endingBounce 0.513s ease-in-out infinite;
}

/* Ensure ending characters appear with proper delay */
.ending-character:nth-child(1) {
  animation-delay: 0s;
}

.ending-character:nth-child(2) {
  animation-delay: 0.8s;
}

@keyframes walkingFrames {
  0%,
  49% {
    background-image: var(--character-img1);
  }
  50%,
  100% {
    background-image: var(--character-img2);
  }
}

@keyframes bounce {
  0%,
  100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-8px);
  }
}

/* Independent animations for ending characters */
@keyframes endingWalkingFrames {
  0%,
  49% {
    background-image: var(--character-img1);
  }
  50%,
  100% {
    background-image: var(--character-img2);
  }
}

/* Simple fade-in animation for ending characters */
@keyframes endingFadeIn {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

/* Bounce animation for ending characters */
@keyframes endingBounce {
  0%,
  100% {
    transform: translateY(0px) scaleX(-1);
  }
  50% {
    transform: translateY(-8px) scaleX(-1);
  }
}

/* Hop animation for space key */
.walking-character.hopping {
  animation: walkingFrames 1.026s steps(1) infinite,
    hop 1.026s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* More satisfying easing */
}

@keyframes hop {
  0% {
    transform: translateY(0px);
  }

  35% {
    transform: translateY(-39px); /* Higher jump with stretch */
  }
  39% {
    transform: translateY(-39px); /* Hang time at peak */
  }
  70% {
    transform: translateY(-8px); /* Slower descent start */
  }
  100% {
    transform: translateY(0px); /* Settle */
  }
}

/* Animation control for walking character */
.paused .walking-character {
  animation-play-state: paused;
}

.playing .walking-character {
  animation-play-state: running;
}

/* Animation control for ending characters */
.paused .ending-character {
  animation-play-state: paused;
}

.playing .ending-character {
  animation-play-state: running;
}

/* Stop animation class for ending characters */
.ending-character.stop-animation {
  animation: none;
  opacity: 1; /* Keep characters visible */
  background-image: var(--character-img1);
  transform: translateZ(0) scaleX(-1);
}

.walking-character.stop-animation {
  animation: none;
  opacity: 1; /* Keep characters visible */
  background-image: var(--character-img1);
  transform: translateZ(0);
  z-index: 0;
}
